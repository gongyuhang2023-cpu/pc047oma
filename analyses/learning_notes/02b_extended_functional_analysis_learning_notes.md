# 02b 扩展功能分析 (Extended Functional Analysis) - 学习笔记

**文件**: `02b_extended_functional_analysis.qmd`
**学习日期**: 2026-01-20
**参考**: OMA Chapter 16-20, HUMAnN4 Analysis Protocol

---

## 目录

1. [分析目标与逻辑](#1-分析目标与逻辑)
2. [GO/PFAM数据理解](#2-gopfam数据理解)
3. [差异分析结果](#3-差异分析结果)
4. [与02分析的整合](#4-与02分析的整合)
5. [对假说的影响](#5-对假说的影响)

---

## 1. 分析目标与逻辑

### 1.1 核心问题

> **在Pathway和KO层面未发现显著差异的情况下，更精细的功能层面（GO/PFAM）是否存在差异？**

### 1.2 分析逻辑链

```
02分析: Pathway/KO层面 → 无FDR显著差异 → 功能冗余假说
    ↓
02b分析: GO/PFAM层面 → 进一步验证功能冗余假说
```

### 1.3 分析大纲

| Part | 内容 | 问题 |
|------|------|------|
| Part 1 | GO (Gene Ontology) 差异分析 | 分子功能/生物过程层面是否有差异？ |
| Part 2 | PFAM (蛋白结构域) 差异分析 | 蛋白结构域层面是否有差异？ |
| Part 3 | Gene Families 分析 | 最精细的基因家族层面 |

---

## 2. GO/PFAM数据理解

### 2.1 HUMAnN功能层级

HUMAnN4可以将基因家族映射到多种功能注释体系：

| 功能层级 | 特征数 | 粒度 | 来源 |
|----------|--------|------|------|
| **Pathway (MetaCyc)** | ~500 | 粗 | 代谢通路 |
| **KO (KEGG)** | ~6,000 | 中 | 基因直系同源 |
| **GO (Gene Ontology)** | ~13,000 | 细 | 分子功能/生物过程 |
| **PFAM** | ~7,600 | 细 | 蛋白结构域 |
| **Gene Families (UniRef90)** | ~430万 | 最细 | 原始基因家族 |

### 2.2 GO分类系统

GO (Gene Ontology) 将基因功能分为三个独立的本体：

| GO分支 | 英文 | 问的问题 |
|--------|------|----------|
| **MF** | Molecular Function | 基因产物做什么？（酶活性等） |
| **BP** | Biological Process | 参与什么生物过程？（代谢、信号等） |
| **CC** | Cellular Component | 位于细胞哪里？ |

**示例**：
```
GO:0003868 - 4-alpha-glucanotransferase activity (MF)
GO:0030429 - biosynthetic process (BP)
```

### 2.3 PFAM蛋白结构域

PFAM是蛋白质家族和结构域数据库：
- 基于序列比对识别保守的蛋白结构域
- 比GO更聚焦于蛋白质结构特征
- 常用于预测蛋白功能

---

## 3. 差异分析结果

### 3.1 分析方法

使用MaAsLin2进行差异分析（与02分析一致）：

```r
Maaslin2(
  input_data = go_matrix,
  input_metadata = metadata,
  fixed_effects = c("treatment_group"),
  normalization = "NONE",    # HUMAnN输出已标准化
  transform = "LOG",
  analysis_method = "LM",
  correction = "BH",
  min_prevalence = 0.1
)
```

### 3.2 结果汇总

| 功能层面 | 检测特征数 | P<0.05 | **FDR<0.05** | 结论 |
|----------|------------|--------|-------------|------|
| **GO** | ~13,000 | 1,577 | **0** | 无显著差异 |
| **PFAM** | ~7,600 | 849 | **0** | 无显著差异 |
| Gene Families | 75 (过滤后) | - | - | 特征数太少 |

### 3.3 关键发现

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  功能冗余假说全面验证                                                        │
│                                                                              │
│  Pathway: P<0.05多个，FDR<0.05 = 0 ✓                                        │
│  KO:      P<0.05多个，FDR<0.05 = 0 ✓                                        │
│  GO:      P<0.05=1577，FDR<0.05 = 0 ✓                                       │
│  PFAM:    P<0.05=849，FDR<0.05 = 0 ✓                                        │
│                                                                              │
│  结论：从粗到细的所有功能层面，FDR校正后均无显著差异                          │
│        功能冗余假说得到全面验证                                               │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 为什么P<0.05有很多但FDR<0.05为0？

这是多重检验校正的正常结果：

| 指标 | GO分析 | 解释 |
|------|--------|------|
| 检测特征数 | ~13,000 | 进行了1.3万次统计检验 |
| 期望假阳性 (5%) | ~650 | 即使完全随机也会有这么多P<0.05 |
| 实际P<0.05 | 1,577 | 略多于期望（可能有微弱信号） |
| FDR校正后 | 0 | 没有一个能经受严格校正 |

**结论**：观察到的P<0.05结果可能大部分是假阳性，真正的生物学信号太弱。

---

## 4. 与02分析的整合

### 4.1 功能层级完整验证

| 分析文件 | 功能层面 | FDR显著数 | 状态 |
|----------|----------|-----------|------|
| 02 | Pathway | 0 | 功能冗余 |
| 02 | KO | 0 | 功能冗余 |
| **02b** | **GO** | **0** | **功能冗余** |
| **02b** | **PFAM** | **0** | **功能冗余** |

### 4.2 与Part 9 Driver更替的关系

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  看似矛盾但实际一致的发现                                                    │
│                                                                              │
│  02b发现：功能总量在各层面均无显著差异                                        │
│  Part 9发现：功能执行者（Driver物种）发生了显著更替                          │
│                                                                              │
│  解释：                                                                       │
│  - 功能"总量"不变 ← 02b验证                                                  │
│  - 功能"执行者"改变 ← Part 9验证                                             │
│  - 这正是功能冗余的定义：不同物种可执行相同功能                               │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 对假说的影响

### 5.1 "Functional Footprint"假说更新

| 假说步骤 | 预期 | 02b结果 | 状态 |
|----------|------|---------|------|
| 代谢功能改变 | GO/PFAM显著差异 | **无FDR显著差异** | ✗ 不支持 |
| 功能冗余 | - | **全面验证** | ✓ 支持 |

### 5.2 机制假说调整

```
原假说：CagA → 代谢功能改变 → 代谢物变化 → T细胞激活

调整后：CagA → 物种组成改变（功能冗余）→ 抗原谱改变 → T细胞激活
              ↓
         执行者更替（Part 9）
              ↓
         免疫刺激来源改变
```

### 5.3 后续研究方向

| 方向 | 依据 | 所需数据 |
|------|------|----------|
| 代谢组学 | 虽然功能潜力不变，实际代谢物可能有差异 | LC-MS/GC-MS |
| 免疫学验证 | 不同物种的免疫原性不同 | T细胞实验 |
| 宏转录组 | 功能潜力(DNA)vs表达(RNA)可能不同 | RNA-seq |

---

## 关键术语速查表

| 术语 | 英文 | 简单解释 |
|------|------|----------|
| GO | Gene Ontology | 基因功能本体论，分子功能/生物过程/细胞组分 |
| PFAM | Protein Family | 蛋白质家族和结构域数据库 |
| FDR | False Discovery Rate | 假发现率，多重检验校正方法 |
| BH校正 | Benjamini-Hochberg | 控制FDR的常用方法 |

---

## 输出文件

| 文件 | 内容 |
|------|------|
| `01_go_daa_results.csv` | GO差异分析完整结果 |
| `02_pfam_daa_results.csv` | PFAM差异分析完整结果 |
| `03_genefamilies_daa_results.csv` | Gene Families差异分析结果 |

---

**下一步**：阅读 `03c_cooccurrence_network_learning_notes.md` 了解共现网络分析

---

*笔记由 Claude 协助整理 | 参考 OMA Chapter 16-20*
